import{l as e,av as a,a6 as t,y as i,d as l,r,a0 as v,ad as u,c as s,G as o,s as n,a5 as c,af as h,ag as d,at as f,x as p,g,t as w,aw as m,M as b,ax as y,C as x,ar as S,a2 as C}from"./index.719c5909.js";import{i as z}from"./style.712d8f68.js";function M(){var i=e(a?window.innerWidth:0),l=e(a?window.innerHeight:0),r=()=>{i.value=window.innerWidth,l.value=window.innerHeight};return t("resize",r),t("orientationchange",r),{width:i,height:l}}var[T,N]=i("swipe"),I={loop:w,width:[Number,String],height:[Number,String],vertical:Boolean,touchable:w,lazyRender:Boolean,indicatorColor:String,showIndicators:w,stopPropagation:w,autoplay:{type:[Number,String],default:0},duration:{type:[Number,String],default:500},initialSwipe:{type:[Number,String],default:0}},O=Symbol(T),X=x(l({name:T,props:I,emits:["change"],setup(i,{emit:l,slots:w}){var x,S,C,T,I=e(),X=r({rect:null,width:0,height:0,offset:0,active:0,swiping:!1}),Y=v(),k=M(),{children:D,linkChildren:H}=u(O),W=s((()=>D.length)),j=s((()=>X[i.vertical?"height":"width"])),B=s((()=>i.vertical?Y.deltaY.value:Y.deltaX.value)),P=s((()=>X.rect?(i.vertical?X.rect.height:X.rect.width)-j.value*W.value:0)),R=s((()=>Math.ceil(Math.abs(P.value)/j.value))),A=s((()=>W.value*j.value)),E=s((()=>(X.active+W.value)%W.value)),G=s((()=>{var e=i.vertical?"vertical":"horizontal";return Y.direction.value===e})),q=s((()=>{var e={transitionDuration:(X.swiping?0:i.duration)+"ms",transform:"translate"+(i.vertical?"Y":"X")+"("+X.offset+"px)"};if(j.value){var a=i.vertical?"height":"width",t=i.vertical?"width":"height";e[a]=A.value+"px",e[t]=i[t]?i[t]+"px":""}return e})),F=(e,a=0)=>{var t=e*j.value;i.loop||(t=Math.min(t,-P.value));var l=a-t;return i.loop||(l=y(l,P.value,0)),l},J=({pace:e=0,offset:a=0,emitChange:t})=>{if(!(W.value<=1)){var{active:r}=X,v=(e=>{var{active:a}=X;return e?i.loop?y(a+e,-1,W.value):y(a+e,0,R.value):a})(e),u=F(v,a);if(i.loop){if(D[0]&&u!==P.value){var s=u<P.value;D[0].setOffset(s?A.value:0)}if(D[W.value-1]&&0!==u){var o=u>0;D[W.value-1].setOffset(o?-A.value:0)}}X.active=v,X.offset=u,t&&v!==r&&l("change",E.value)}},K=()=>{X.swiping=!0,X.active<=-1?J({pace:W.value}):X.active>=W.value&&J({pace:-W.value})},L=()=>{K(),Y.reset(),m((()=>{X.swiping=!1,J({pace:1,emitChange:!0})}))},Q=()=>clearTimeout(x),U=()=>{Q(),i.autoplay>0&&W.value>1&&(x=setTimeout((()=>{L(),U()}),+i.autoplay))},V=(e=+i.initialSwipe)=>{if(I.value){if(!z(I)){var a,t,l={width:I.value.offsetWidth,height:I.value.offsetHeight};X.rect=l,X.width=+(null!=(a=i.width)?a:l.width),X.height=+(null!=(t=i.height)?t:l.height)}W.value&&(e=Math.min(W.value-1,e)),X.active=e,X.swiping=!0,X.offset=F(e),D.forEach((e=>{e.setOffset(0)}))}},Z=()=>V(X.active),$=e=>{i.touchable&&(Y.start(e),S=Date.now(),Q(),K())},_=e=>{i.touchable&&X.swiping&&(Y.move(e),G.value&&(b(e,i.stopPropagation),J({offset:B.value})))},ee=()=>{if(i.touchable&&X.swiping){var e=Date.now()-S,a=B.value/e;if((Math.abs(a)>.25||Math.abs(B.value)>j.value/2)&&G.value){var t=i.vertical?Y.offsetY.value:Y.offsetX.value,l=0;l=i.loop?t>0?B.value>0?-1:1:0:-Math[B.value>0?"ceil":"floor"](B.value/j.value),J({pace:l,emitChange:!0})}else B.value&&J({pace:0});X.swiping=!1,U()}},ae=(e,a)=>{var t=a===E.value,l=t?{backgroundColor:i.indicatorColor}:void 0;return g("i",{style:l,class:N("indicator",{active:t})},null)};return o({prev:()=>{K(),Y.reset(),m((()=>{X.swiping=!1,J({pace:-1,emitChange:!0})}))},next:L,state:X,resize:Z,swipeTo:(e,a={})=>{K(),Y.reset(),m((()=>{var t;t=i.loop&&e===W.value?0===X.active?0:e:e%W.value,a.immediate?m((()=>{X.swiping=!1})):X.swiping=!1,J({pace:t-X.active,emitChange:!0})}))}}),H({size:j,props:i,count:W,activeIndicator:E}),n((()=>i.initialSwipe),(e=>V(+e))),n(W,(()=>V(X.active))),n([W,()=>i.autoplay],U),n([k.width,k.height],Z),n((C=e("visible"),(T=()=>{a&&(C.value=document.hidden?"hidden":"visible")})(),t("visibilitychange",T),C),(e=>{"visible"===e?U():Q()})),c(V),h((()=>V(X.active))),d((()=>V(X.active))),f(Q),p(Q),()=>g("div",{ref:I,class:N()},[g("div",{style:q.value,class:N("track",{vertical:i.vertical}),onTouchstart:$,onTouchmove:_,onTouchend:ee,onTouchcancel:ee},[null==w.default?void 0:w.default()]),w.indicator?w.indicator({active:E.value}):i.showIndicators&&W.value>1?g("div",{class:N("indicators",{vertical:i.vertical})},[Array(W.value).fill("").map(ae)]):void 0])}})),[Y,k]=i("swipe-item"),D=x(l({name:Y,setup(e,{slots:a}){var t,i=r({offset:0,inited:!1,mounted:!1}),{parent:l,index:v}=S(O);if(l){var u=s((()=>{var e={},{vertical:a}=l.props;return l.size.value&&(e[a?"height":"width"]=l.size.value+"px"),i.offset&&(e.transform="translate"+(a?"Y":"X")+"("+i.offset+"px)"),e})),n=s((()=>{var{loop:e,lazyRender:a}=l.props;if(!a||t)return!0;if(!i.mounted)return!1;var r=l.activeIndicator.value,u=l.count.value-1,s=0===r&&e?u:r-1,o=r===u&&e?0:r+1;return t=v.value===r||v.value===s||v.value===o}));return c((()=>{C((()=>{i.mounted=!0}))})),o({setOffset:e=>{i.offset=e}}),()=>g("div",{class:k(),style:u.value},[n.value?null==a.default?void 0:a.default():null])}}}));export{X as S,D as a,M as u};
