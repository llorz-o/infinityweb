let e=document.createElement("style");e.innerHTML=".Setting .headerAction{text-align:center;line-height:10.66667vw;font-size:3.46667vw;color:#ff4757}",document.head.appendChild(e);import{d as a,r as t,a0 as o,c as l,s as i,g as r,y as n,M as s,ax as u,a1 as m,t as d,aq as c,l as v,G as p,a5 as f,a2 as g,B as h,L as b,aC as w,aj as y,I as x,v as S,D as V,C as z,aN as C,aO as k,aP as N,aQ as F,n as I,aR as R,aS as U,aT as P,J as _,a as A,b as T,aU as X,aV as B,aH as O,aF as j,S as D,aW as H,e as L,o as Y,f as Z,j as W,h as M,Q as q}from"./index.719c5909.js";import{R as E,a as $}from"./index.baf5bbba.js";import{a as Q,u as G,S as J}from"./index.2f92aa39.js";import{I as K}from"./index.0748ebb8.js";import"./style.712d8f68.js";function ee(e){return Math.sqrt(Math.pow(e[0].clientX-e[1].clientX,2)+Math.pow(e[0].clientY-e[1].clientY,2))}var ae,te=n("image-preview")[1],oe=a({props:{src:String,show:Boolean,active:Number,minZoom:{type:[Number,String],required:!0},maxZoom:{type:[Number,String],required:!0},rootWidth:{type:Number,required:!0},rootHeight:{type:Number,required:!0}},emits:["scale","close"],setup(e,{emit:a}){var n,d,c,v,p,f,g=t({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),h=o(),b=l((()=>{var{rootWidth:a,rootHeight:t}=e,o=t/a;return g.imageRatio>o})),w=l((()=>{var{scale:e,moveX:a,moveY:t,moving:o,zooming:l}=g,i={transitionDuration:l||o?"0s":".3s"};if(1!==e){var r=a/e,n=t/e;i.transform="scale("+e+", "+e+") translate("+r+"px, "+n+"px)"}return i})),y=l((()=>{if(g.imageRatio){var{rootWidth:a,rootHeight:t}=e,o=b.value?t/g.imageRatio:a;return Math.max(0,(g.scale*o-a)/2)}return 0})),x=l((()=>{if(g.imageRatio){var{rootWidth:a,rootHeight:t}=e,o=b.value?t:a*g.imageRatio;return Math.max(0,(g.scale*o-t)/2)}return 0})),S=t=>{(t=u(t,+e.minZoom,+e.maxZoom))!==g.scale&&(g.scale=t,a("scale",{scale:t,index:e.active}))},V=()=>{S(1),g.moveX=0,g.moveY=0},z=e=>{var{touches:a}=e,{offsetX:t}=h;h.start(e),n=g.moveX,d=g.moveY,f=Date.now(),g.moving=1===a.length&&1!==g.scale,g.zooming=2===a.length&&!t.value,g.zooming&&(c=g.scale,v=ee(e.touches))},C=e=>{var{touches:a}=e;if(h.move(e),(g.moving||g.zooming)&&s(e,!0),g.moving){var{deltaX:t,deltaY:o}=h,l=t.value+n,i=o.value+d;g.moveX=u(l,-y.value,y.value),g.moveY=u(i,-x.value,x.value)}if(g.zooming&&2===a.length){var r=ee(a);S(c*r/v)}},k=()=>{var e,{offsetX:t,offsetY:o}=h,l=Date.now()-f;t.value<10&&o.value<10&&l<250&&(p?(clearTimeout(p),p=null,e=g.scale>1?1:2,S(e),g.moveX=0,g.moveY=0):p=setTimeout((()=>{a("close"),p=null}),250))},N=e=>{var a=!1;(g.moving||g.zooming)&&(a=!0,g.moving&&n===g.moveX&&d===g.moveY&&(a=!1),e.touches.length||(g.zooming&&(g.moveX=u(g.moveX,-y.value,y.value),g.moveY=u(g.moveY,-x.value,x.value),g.zooming=!1),g.moving=!1,n=0,d=0,c=1,g.scale<1&&V())),s(e,a),k(),h.reset()},F=e=>{var{naturalWidth:a,naturalHeight:t}=e.target;g.imageRatio=t/a};return i((()=>e.active),V),i((()=>e.show),(e=>{e||V()})),()=>{var a={loading:()=>r(m,{type:"spinner"},null)};return r(Q,{class:te("swipe-item"),onTouchstart:z,onTouchmove:C,onTouchend:N,onTouchcancel:N},{default:()=>[r(K,{src:e.src,fit:"contain",class:te("image",{vertical:b.value}),style:w.value,onLoad:F},a)]})}}}),[le,ie]=n("image-preview"),re=a({name:le,props:{show:Boolean,loop:d,overlay:d,closeable:Boolean,showIndex:d,className:c,transition:String,beforeClose:Function,overlayStyle:Object,showIndicators:Boolean,closeOnPopstate:d,images:{type:Array,default:()=>[]},minZoom:{type:[Number,String],default:1/3},maxZoom:{type:[Number,String],default:3},swipeDuration:{type:[Number,String],default:300},startPosition:{type:[Number,String],default:0},closeIcon:{type:String,default:"clear"},closeIconPosition:{type:String,default:"top-right"}},emits:["scale","close","closed","change","update:show"],setup(e,{emit:a,slots:o}){var l=v(),n=G(),s=t({active:0,rootWidth:0,rootHeight:0}),u=()=>{if(l.value){var e=l.value.$el.getBoundingClientRect();s.rootWidth=e.width,s.rootHeight=e.height,l.value.resize()}},m=e=>a("scale",e),d=e=>a("update:show",e),c=()=>{y({interceptor:e.beforeClose,args:[s.active],done:()=>d(!1)})},S=e=>{e!==s.active&&(s.active=e,a("change",e))},V=()=>{if(e.showIndex)return r("div",{class:ie("index")},[o.index?o.index({index:s.active}):s.active+1+" / "+e.images.length])},z=()=>{if(o.cover)return r("div",{class:ie("cover")},[o.cover()])},C=()=>{if(e.closeable)return r(x,{role:"button",name:e.closeIcon,class:ie("close-icon",e.closeIconPosition),onClick:c},null)},k=()=>a("closed"),N=(e,a)=>{var t;return null==(t=l.value)?void 0:t.swipeTo(e,a)};return p({swipeTo:N}),f(u),i([n.width,n.height],u),i((()=>e.startPosition),(e=>S(+e))),i((()=>e.show),(t=>{var{images:o,startPosition:l}=e;t?(S(+l),g((()=>{u(),N(+l,{immediate:!0})}))):a("close",{index:s.active,url:o[s.active]})})),()=>r(w,h({class:[ie(),e.className],overlayClass:ie("overlay"),onClosed:k},b(e,["show","transition","overlayStyle","closeOnPopstate"]),{"onUpdate:show":d}),{default:()=>[C(),r(J,{ref:l,lazyRender:!0,loop:e.loop,class:ie("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:S},{default:()=>[e.images.map((a=>r(oe,{src:a,show:e.show,active:s.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:s.rootWidth,rootHeight:s.rootHeight,onScale:m,onClose:c},null)))]}),V(),z()]})}}),ne={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};var se=(e,a=0)=>{if(S){ae||({instance:ae}=C({setup(){var{state:e,toggle:a}=k(),t=()=>{e.images=[]};return()=>r(re,h(e,{onClosed:t,"onUpdate:show":a}),null)}}));var t=Array.isArray(e)?{images:e,startPosition:a}:e;return ae.open(V({},ne,t)),ae}};se.Component=z(re),se.install=e=>{e.use(z(re))};var[ue,me]=n("uploader");function de(e){return Array.isArray(e)?e:[e]}function ce(e,a){return new Promise((t=>{if("file"!==a){var o=new FileReader;o.onload=e=>{t(e.target.result)},"dataUrl"===a?o.readAsDataURL(e):"text"===a&&o.readAsText(e)}else t()}))}function ve(e,a){return de(e).some((e=>!!e.file&&(N(a)?a(e.file):e.file.size>a)))}var pe=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg)/i;function fe(e){return!!e.isImage||(e.file&&e.file.type?0===e.file.type.indexOf("image"):e.url?(a=e.url,pe.test(a)):"string"==typeof e.content&&0===e.content.indexOf("data:image"));var a}var ge=a({props:{name:[Number,String],index:Number,imageFit:String,lazyLoad:Boolean,deletable:Boolean,previewSize:[Number,String],beforeDelete:Function,item:{type:Object,required:!0}},emits:["delete","preview"],setup(e,{emit:a,slots:t}){var o=()=>{var{status:a,message:t}=e.item;if("uploading"===a||"failed"===a){var o="failed"===a?r(x,{name:"close",class:me("mask-icon")},null):r(m,{class:me("loading")},null),l=I(t)&&""!==t;return r("div",{class:me("mask")},[o,l&&r("div",{class:me("mask-message")},[t])])}},l=t=>{var{name:o,item:l,index:i,beforeDelete:r}=e;t.stopPropagation(),y({interceptor:r,args:[l,{name:o,index:i}],done:()=>a("delete")})},i=()=>a("preview"),n=()=>{if(e.deletable&&"uploading"!==e.item.status)return r("div",{class:me("preview-delete"),onClick:l},[r(x,{name:"cross",class:me("preview-delete-icon")},null)])},s=()=>{if(t["preview-cover"]){var{index:a,item:o}=e;return r("div",{class:me("preview-cover")},[t["preview-cover"](V({index:a},o))])}},u=()=>{var{item:a}=e;return fe(a)?r(K,{fit:e.imageFit,src:a.content||a.url,class:me("preview-image"),width:e.previewSize,height:e.previewSize,lazyLoad:e.lazyLoad,onClick:i},{default:()=>[s()]}):r("div",{class:me("file"),style:F(e.previewSize)},[r(x,{class:me("file-icon"),name:"description"},null),r("div",{class:[me("file-name"),"van-ellipsis"]},[a.file?a.file.name:a.url]),s()])};return()=>r("div",{class:me("preview")},[u(),o(),n()])}}),he=a({name:ue,props:{capture:String,multiple:Boolean,disabled:Boolean,lazyLoad:Boolean,uploadText:String,deletable:d,afterRead:Function,showUpload:d,beforeRead:Function,beforeDelete:Function,previewSize:[Number,String],previewImage:d,previewOptions:Object,previewFullImage:d,name:{type:[Number,String],default:""},accept:{type:String,default:"image/*"},modelValue:{type:Array,default:()=>[]},maxSize:{type:[Number,String,Function],default:Number.MAX_VALUE},maxCount:{type:[Number,String],default:Number.MAX_VALUE},imageFit:{type:String,default:"cover"},resultType:{type:String,default:"dataUrl"},uploadIcon:{type:String,default:"photograph"}},emits:["delete","oversize","close-preview","click-preview","update:modelValue"],setup(e,{emit:a,slots:o}){var l,i=v(),n=(a=e.modelValue.length)=>({name:e.name,index:a}),s=()=>{i.value&&(i.value.value="")},u=o=>{if(s(),ve(o,e.maxSize)){if(!Array.isArray(o))return void a("oversize",o,n());var l=function(e,a){var t=[],o=[];return e.forEach((e=>{ve(e,a)?o.push(e):t.push(e)})),{valid:t,invalid:o}}(o,e.maxSize);if(o=l.valid,a("oversize",l.invalid,n()),!o.length)return}o=t(o),a("update:modelValue",[...e.modelValue,...de(o)]),e.afterRead&&e.afterRead(o,n())},m=a=>{var{maxCount:t,modelValue:o,resultType:l}=e;if(Array.isArray(a)){var i=+t-o.length;a.length>i&&(a=a.slice(0,i)),Promise.all(a.map((e=>ce(e,l)))).then((e=>{var t=a.map(((a,t)=>{var o={file:a,status:"",message:""};return e[t]&&(o.content=e[t]),o}));u(t)}))}else ce(a,l).then((e=>{var t={file:a,status:"",message:""};e&&(t.content=e),u(t)}))},d=a=>{var{files:t}=a.target;if(!e.disabled&&t&&t.length){var o=1===t.length?t[0]:[].slice.call(t);if(e.beforeRead){var l=e.beforeRead(o,n());if(!l)return void s();if(U(l))return void l.then((e=>{m(e||o)})).catch(s)}m(o)}},c=()=>a("close-preview"),f=(t,i)=>{var s=["imageFit","deletable","previewSize","beforeDelete"],u=V(b(e,s),b(t,s,!0));return r(ge,h({item:t,index:i,onClick:()=>a("click-preview",t,n(i)),onDelete:()=>((t,o)=>{var l=e.modelValue.slice(0);l.splice(o,1),a("update:modelValue",l),a("delete",t,n(o))})(t,i),onPreview:()=>(a=>{if(e.previewFullImage){var t=e.modelValue.filter(fe),o=t.map((e=>e.content||e.url)).filter(Boolean);l=se(V({images:o,startPosition:t.indexOf(a),onClose:c},e.previewOptions))}})(t)},b(e,["name","lazyLoad"]),u),{"preview-cover":o["preview-cover"]})},g=()=>{if(e.previewImage)return e.modelValue.map(f)},w=()=>{if(!(e.modelValue.length>=e.maxCount)&&e.showUpload){var a=r("input",{ref:i,type:"file",class:me("input"),accept:e.accept,capture:e.capture,multiple:e.multiple,disabled:e.disabled,onChange:d},null);return o.default?r("div",{class:me("input-wrapper")},[o.default(),a]):r("div",{class:me("upload"),style:F(e.previewSize)},[r(x,{name:e.uploadIcon,class:me("upload-icon")},null),e.uploadText&&r("span",{class:me("upload-text")},[e.uploadText]),a])}};return p({chooseFile:()=>{i.value&&!e.disabled&&i.value.click()},closeImagePreview:()=>{l&&l.close()}}),R((()=>e.modelValue)),()=>r("div",{class:me()},[r("div",{class:me("wrapper",{disabled:e.disabled})},[g(),w()])])}}),be=z(he),we={components:{[P.name]:P,[_.name]:_,[E.name]:E,[$.name]:$,[be.name]:be},setup(){const e=A(),a=T(),o=l((()=>a.state.userinfo)),i=v([o.value.avatarUrl&&{url:`${X}/avatar/`+o.value.avatarUrl}]),r=v(),n=t({avatar_url:o.value.avatarUrl,nickname:o.value.nickname,gender:o.value.gender,phone_number:o.value.phoneNumber,email_address:o.value.emailAddress,bio:o.value.bio});let s=!1;return B(((e,a,t)=>{if(s)return t(!0);H.confirm({title:"确认",message:"是否放弃本次更改？",confirmButtonText:"放弃",cancelButtonText:"继续编辑",showCancelButton:!0,closeOnPopstate:!1,beforeClose:e=>new Promise((a=>{"cancel"===e&&(a(!0),t(!1)),"confirm"===e&&(a(!0),t(!0))}))})})),{avatar:i,form:n,afterRead:async function(e){e.status="uploading",e.message="上传中。。。";const a=await O.factor().uploadUserAvatar(e.file);if(a.code)return e.status="failed",void(e.message="上传失败");e.status="success",e.message="",e.url=`${X}/avatar/`+a.data,n.avatar_url=a.data},vanForm:r,submitForm:async function(){if(!(await O.factor().updateUserInfo({...n})).code)return j.success("用户信息已更新"),a.commit(D.SET_USER_INFO,n),s=!0,void e.back()},patternNickname:/^[\w\u2E80-\u9FFF]{3,10}$/}}};const ye=q(" 用户信息 "),xe=q("男"),Se=q("女");we.render=function(e,a,t,o,l,i){const n=L("Header"),s=L("van-uploader"),u=L("van-field"),m=L("van-radio"),d=L("van-radio-group"),c=L("van-form"),v=L("Layout");return Y(),Z(v,{class:"Setting",header:""},{default:W((()=>[r(n,{class:"van-hairline--bottom",fixed:"",animation:"",onClickLeft:a[2]||(a[2]=a=>e.$router.back())},{actions:W((()=>[r("div",{class:"headerAction",onClick:a[1]||(a[1]=(...e)=>o.submitForm&&o.submitForm(...e))},"保存")])),default:W((()=>[ye])),_:1}),r(c,{ref:"vanForm",onSubmit:o.submitForm},{default:W((()=>[M(" 头像 "),r(u,{name:"uploader",label:"头像"},{input:W((()=>[r(s,{modelValue:o.avatar,"onUpdate:modelValue":a[3]||(a[3]=e=>o.avatar=e),name:"avatar","result-type":"file","max-count":1,"after-read":o.afterRead},null,8,["modelValue","after-read"])])),_:1}),M(" 用户昵称 "),r(u,{modelValue:o.form.nickname,"onUpdate:modelValue":a[4]||(a[4]=e=>o.form.nickname=e),colon:"",clearable:"",clickable:"",name:"nickname",label:"昵称",placeholder:"昵称",rules:[{pattern:o.patternNickname,message:"中英文下划线组合3～10位用户昵称"}]},null,8,["modelValue","rules"]),M(" 性别 "),r(u,{colon:"",clearable:"",clickable:"",name:"gender",label:"单选框"},{input:W((()=>[r(d,{modelValue:o.form.gender,"onUpdate:modelValue":a[5]||(a[5]=e=>o.form.gender=e),direction:"horizontal"},{default:W((()=>[r(m,{name:1},{default:W((()=>[xe])),_:1}),r(m,{name:2},{default:W((()=>[Se])),_:1})])),_:1},8,["modelValue"])])),_:1}),M(" 邮箱地址 "),r(u,{modelValue:o.form.bio,"onUpdate:modelValue":a[6]||(a[6]=e=>o.form.bio=e),colon:"",clearable:"",clickable:"",name:"bio",label:"签名",placeholder:"关于自己",maxlength:"60"},null,8,["modelValue"]),M(" 手机号 "),r(u,{modelValue:o.form.phone_number,"onUpdate:modelValue":a[7]||(a[7]=e=>o.form.phone_number=e),colon:"",clearable:"",clickable:"",type:"tel",name:"phone",label:"手机号",placeholder:"手机号"},null,8,["modelValue"]),M(" 邮箱地址 "),r(u,{modelValue:o.form.email_address,"onUpdate:modelValue":a[8]||(a[8]=e=>o.form.email_address=e),colon:"",clearable:"",clickable:"",name:"email_address",label:"邮箱",placeholder:"邮箱地址"},null,8,["modelValue"])])),_:1},8,["onSubmit"])])),_:1})};export default we;
