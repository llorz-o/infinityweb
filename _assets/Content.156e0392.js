let e=document.createElement("style");e.innerHTML='.comment-edit .user-info{padding:2.66667vw 4vw 1.33333vw}.comment-edit .user-info .user-avatar{height:6.66667vw;width:6.66667vw}.comment-edit .user-info .user-nickname{margin-left:2.13333vw}.comment-item{padding:1.33333vw 0;background-color:#fff}.comment-item ._nickname,.comment-item .comment .reply-nickname,.comment-item .comment-chilren .nickname,.comment-item .comment-info .nickname{color:#09f;text-shadow:1px 1px #2f4f4f}.comment-item .comment--deleted{color:#969799}.comment-item .comment-avatar{width:6.4vw;height:6.4vw;margin-top:2.13333vw}.comment-item .comment-time{color:#969799;font-size:2.66667vw}.comment-item .comment-content{font-size:3.73333vw;color:#323233}.comment-item .comment-content .top-tag{margin-right:1.33333vw}.comment-item .comment-actions .btn{display:flex;align-items:center;padding:1.33333vw;height:7.46667vw}.comment-item .comment-actions .btn-like{min-width:9.06667vw}.comment-item .comment-actions .btn-like .value{font-size:2.66667vw;color:#969799}.comment-item .comment-actions .btn-unlike .icon{transform:rotate(180deg)}.comment-item .comment-actions .btn-option{margin-left:auto}.comment-item .comment-actions .btn-option i{transform:rotateZ(90deg)}.comment-item .comment-actions .btn-more{font-size:2.66667vw;color:#969799}.comment-item .comment-actions .btn .icon.active{color:#9cf}.comment-item .comment-actions .btn .btn{font-size:4vw;color:#969799}.comment-item .comment-chilren{background-color:#f2f3f5;padding:1.33333vw;border-radius:1.33333vw;margin-top:.8vw}.comment-item .comment-chilren .content{margin-left:.8vw}.comment-item .comment-chilren .btn-more{font-size:3.2vw;color:#369;margin-top:.8vw}.comment-conversation-pop{background-color:#f2f3f5}.comment-conversation-pop .title{height:8vw;line-height:8vw;background-color:#fff;padding-left:2.13333vw}.comment-conversation-pop>.content{height:calc(100% - 8vw);overflow-y:auto}.comment-conversation-pop .comment-item{padding:0 2.66667vw}.comment-conversation-pop .btn-more{display:none!important}.comment-pop{background-color:#f2f3f5}.comment-pop .title{height:8vw;line-height:8vw;background-color:#fff;padding-left:2.13333vw}.comment-pop>.content{height:calc(100% - 8vw);overflow-y:auto}.comment-pop .lists{background-color:#fff;margin-top:2.13333vw}.comment-pop .comment-item{padding:0 2.66667vw}.comment-pop .comment-item.master-item{padding-bottom:1.33333vw}.comment-pop .comment-item.master-item .btn-reply{display:none}.sponsor-pop{overflow:inherit;padding-top:26.66667vw;background:#f2f3f5;border-radius:2.66667vw;width:80%}.sponsor-pop .title{position:absolute;top:-10.66667vw;left:50%;transform:translateX(-50%);text-align:center;font-size:5.33333vw}.sponsor-pop .title .van-image{width:21.33333vw;height:21.33333vw}.sponsor-pop .price-btns{display:flex;flex-wrap:wrap;justify-content:center;padding-bottom:4vw}.sponsor-pop .price-btns .van-radio__label{border:1px solid #669;padding:2.13333vw 6.93333vw;border-radius:5.33333vw;color:#669;font-size:3.73333vw}.sponsor-pop .price-btns .van-radio{overflow:inherit;margin:2.66667vw 1.33333vw}.sponsor-pop .price-btns .van-radio .van-radio__icon{display:none}.sponsor-pop .price-btns .van-radio[aria-checked=true] .van-radio__label{background:#669;color:#fff;border:1px solid #669}.sponsor-pop .footer{display:flex}.sponsor-pop .footer .van-button{width:50%;border:none;border-radius:0 0 2.66667vw 2.66667vw}.like-item .avatar{width:6.4vw;height:6.4vw}.like-item .nickname{color:#09f;text-shadow:1px 1px #2f4f4f}.like-item .describe{font-size:3.2vw;color:#969799}.Content[data-v-6fec0d90]{overflow:scroll;-webkit-overflow-scrolling:touch;margin-bottom:10.66667vw}.Content .content[data-v-6fec0d90]{padding:1.33333vw 2.66667vw}.Content .content .commentsTitle[data-v-6fec0d90]{padding:2.66667vw 0}.Content .content .sponsorList[data-v-6fec0d90]{text-align:center;padding:2.66667vw 0;line-height:10.66667vw;color:#323233}.Content .content .sponsorList .sponsorInfo[data-v-6fec0d90]{color:#369;margin-right:1.33333vw}.Content .content .sponsorList .tips[data-v-6fec0d90]{display:flex;flex-wrap:wrap;width:80%;margin:0 auto;justify-content:center}.Content .content .sponsorList .tips .tipItem .avatarImage[data-v-6fec0d90]{width:7.73333vw;height:7.73333vw;margin-right:1.33333vw}.Content .title[data-v-6fec0d90]{font-size:5.86667vw;color:#323233}.Content .author .avatarCol[data-v-6fec0d90]{font-size:0}.Content .author .avatarCol .avatarImage[data-v-6fec0d90]{width:7.73333vw;height:7.73333vw}.Content .author .centerCol[data-v-6fec0d90]{padding-left:1.6vw}.Content .author .centerCol .authorName[data-v-6fec0d90]{font-size:3.73333vw}.Content .author .centerCol .publishTime[data-v-6fec0d90]{font-size:2.66667vw;color:#969799}.Content .contentFooter[data-v-6fec0d90]{position:fixed;bottom:0;left:0;right:0;height:10.66667vw;padding:1.6vw 1.33333vw;background-color:#fff}.Content .contentFooter .action[data-v-6fec0d90]{display:flex;align-items:center;justify-content:center}.Content .contentFooter .action .lc-ali-good-fill[data-v-6fec0d90]{color:#9cf}.Content .contentFooter .action .name[data-v-6fec0d90]{font-size:3.2vw;margin-left:.8vw}.contentContent{all:reset;margin-top:2.13333vw}.contentContent *{font-size:3.73333vw}.contentContent h1{font-size:5.33333vw}.contentContent h2{font-size:5.06667vw}.contentContent h3{font-size:4.8vw}.contentContent h4{font-size:4.53333vw;font-weight:400}.contentContent h5{font-size:4.26667vw;font-weight:400}.contentContent h6{font-size:4vw;font-weight:400}.contentContent code,.contentContent pre{background-color:#ccc;padding:0 .53333vw;border-radius:.53333vw}.contentContent ul{padding-left:4.8vw;list-style:initial}.contentContent img{max-width:70%;display:block;margin:1.33333vw auto;border-radius:1.33333vw;box-shadow:0 1px .53333vw rgba(0,0,0,.2);overflow:hidden}.contentContent .at-symbol{background-color:#f2f3f5;border-radius:.8vw;padding:0 1px;margin:0 1px;color:#669}.contentContent .mark-symbol{padding:0 1px;margin:0 1px;color:#369}.contentContent code{background-color:#ebedf0;border-radius:.53333vw;padding:0 .53333vw;color:#ff6348}.contentContent blockquote{padding-left:1.06667vw;border-left:.8vw solid #dcdee0}.Layout.Content .van-badge{white-space:nowrap}.Layout.Content .contentSubTabs .van-tab{flex:unset}.Layout.Content .contentSubTabs .van-tab--active .van-tab__text{color:#669}.Layout.Content .contentSubTabs .van-tab--active::after{position:absolute;display:block;content:"";bottom:0;left:0;right:0;height:.53333vw;background-color:#669}.Layout.Content .Header__title .author{flex:1}.Layout.Content .Header__title .headerRelationBtn{color:#ff4757}',document.head.appendChild(e);import{d as n,D as t,b7 as o,t as a,g as i,B as s,L as c,b8 as l,aC as r,y as m,I as d,a1 as u,a2 as f,C as p,J as v,l as h,T as g,s as k,aF as w,e as C,o as b,f as y,j as _,Q as L,R as I,i as x,b9 as S,ba as A,bb as U,V as R,h as T,Z as M,F as z,P as N,b as $,c as O,bc as j,bd as B,aM as F,_ as H,be as D,r as E,O as P,S as q,u as G,a as V,p as W,x as K,aZ as Z,ay as J,az as Q,aA as X}from"./index.719c5909.js";import{R as Y,C as ee}from"./index.208a711d.js";import{I as ne}from"./index.0748ebb8.js";import{C as te}from"./level.22f85bf1.js";import{T as oe}from"./index.51507c56.js";import{L as ae}from"./index.697a0a58.js";import{a as ie,R as se}from"./index.baf5bbba.js";import{a as ce,T as le}from"./index.020e3357.js";import"./use-tab-status.4fba9145.js";import"./style.712d8f68.js";import"./index.2f92aa39.js";import"./index.66949d4d.js";var[re,me]=m("action-sheet"),de=p(n({name:re,props:t({},o,{title:String,round:a,actions:Array,closeable:a,cancelText:String,description:String,closeOnPopstate:Boolean,closeOnClickAction:Boolean,safeAreaInsetBottom:a,closeIcon:{type:String,default:"cross"}}),emits:["select","cancel","update:show"],setup(e,{slots:n,emit:t}){var o=e=>t("update:show",e),a=()=>{o(!1),t("cancel")},m=()=>{if(e.title)return i("div",{class:me("header")},[e.title,e.closeable&&i(d,{name:e.closeIcon,class:me("close"),onClick:a},null)])},p=()=>{if(n.cancel||e.cancelText)return[i("div",{class:me("gap")},null),i("button",{type:"button",class:me("cancel"),onClick:a},[n.cancel?n.cancel():e.cancelText])]},v=(n,a)=>{var{name:s,color:c,subname:l,loading:r,callback:m,disabled:d,className:p}=n,v=r?i(u,{class:me("loading-icon")},null):[i("span",{class:me("name")},[s]),l&&i("div",{class:me("subname")},[l])];return i("button",{type:"button",style:{color:c},class:[me("item",{loading:r,disabled:d}),p],onClick:()=>{d||r||(m&&m(n),e.closeOnClickAction&&o(!1),f((()=>t("select",n,a))))}},[v])},h=()=>{if(e.description||n.description){var t=n.description?n.description():e.description;return i("div",{class:me("description")},[t])}},g=()=>{if(e.actions)return e.actions.map(v)};return()=>i(r,s({class:me(),round:e.round,position:"bottom",safeAreaInsetBottom:e.safeAreaInsetBottom},c(e,l),{"onUpdate:show":o}),{default:()=>[m(),h(),i("div",{class:me("content")},[g(),null==n.default?void 0:n.default()]),p()]})}}));const ue=n({name:"comment-edit",components:{[Y.name]:Y,[ee.name]:ee,[ne.name]:ne,[r.name]:r,[v.name]:v},props:{field:{required:!0,type:String},show:{required:!0,type:Boolean},sentCallback:{required:!0,type:Function},avatar:String,nickname:String},emits:["closed","update:field","update:show"],setup(e,n){const t=h(""),o=h(!1),{field:a,show:i}=g(e);k(a,(e=>t.value=e)),k(t,(e=>{n.emit("update:field",e)})),k(i,(e=>o.value=e)),k(o,(e=>{n.emit("update:show",e)}));const s=h(!1);return{inputText:t,show:o,sentLoading:s,onSent:function(){if(s.value)return w("请勿重复操作");s.value=!0,e.sentCallback().then((e=>{s.value=!1,e?(w.success("已发送"),o.value=!1):w.fail("发送失败！")})).catch((()=>{s.value=!1,w.fail("发送错误！")}))},onClosed:function(){t.value="",o.value=!1,n.emit("closed")}}}}),fe=L(" 发送 ");ue.render=function(e,n,t,o,a,s){const c=C("van-image"),l=C("van-col"),r=C("van-button"),m=C("van-row"),d=C("van-field"),u=C("van-popup");return b(),y(u,{class:"comment-edit",show:e.show,"onUpdate:show":n[2]||(n[2]=n=>e.show=n),onClosed:e.onClosed,position:"bottom","lock-scroll":"","lazy-render":"","close-on-popstate":"","close-on-click-overlay":"","transition-appear":"",teleport:"#outside-teleport","safe-area-inset-bottom":""},{default:_((()=>[i(m,{class:"user-info",align:"center"},{default:_((()=>[i(l,{span:"2",style:{"font-size":"0"}},{default:_((()=>[i(c,{class:"user-avatar",round:"",src:e.$root.getAvatar(e.avatar),fit:"cover"},null,8,["src"])])),_:1}),i(l,{span:"8",class:"user-nickname"},{default:_((()=>[L(I(e.nickname),1)])),_:1}),i(l,{span:"13",txtr:""},{default:_((()=>[i(r,{type:"primary",color:"$w",size:"mini",loading:e.sentLoading,onClick:e.onSent},{default:_((()=>[fe])),_:1},8,["loading","onClick"])])),_:1})])),_:1}),i(d,{modelValue:e.inputText,"onUpdate:modelValue":n[1]||(n[1]=n=>e.inputText=n),rows:"4",placeholder:"不要默默地看了，快点评论下吧~",type:"textarea",maxlength:"200","show-word-limit":""},null,8,["modelValue"])])),_:1},8,["show","onClosed"])};const pe=n({name:"comment-item",components:{[Y.name]:Y,[ee.name]:ee,[oe.name]:oe,[ne.name]:ne,[te.name]:te},props:{info:{required:!0,type:Object}},setup(e){const{info:n}=g(e),t=x(S);return{openActionsSheet:function(){t&&t(n.value)},authorId:x(A),isLogin:x(U),vertifyLogin:x(R)}}}),ve=L("作者"),he=L("置顶"),ge={key:1,class:"comment--deleted"},ke=L(" 回复 "),we={class:"reply-nickname",tag:"span"},Ce=L(" : "),be={style:{"word-break":"break-all"}},ye={class:"value"},_e=L("查看对话"),Le=L("作者觉的很赞"),Ie={key:1,class:"comment-chilren"},xe={class:"nickname"},Se={class:"content"},Ae=L(" 回复 "),Ue={class:"reply-nickname",tag:"span"};pe.render=function(e,n,t,o,a,s){const c=C("van-image"),l=C("van-col"),r=C("van-tag"),m=C("level"),d=C("van-row"),u=C("van-icon");return e.info?(b(),y(d,{key:0,class:"comment-item van-hairline--bottom",align:"top"},{default:_((()=>[i(l,{span:"2"},{default:_((()=>[i(c,{class:"comment-avatar",src:e.$root.getAvatar(e.info.user.avatarUrl),round:"",fit:"cover"},null,8,["src"])])),_:1}),i(l,{span:"22"},{default:_((()=>[T(" 用户信息 "),i(d,{class:"comment-info",align:"center",gutter:"5"},{default:_((()=>[i(l,{class:"nickname"},{default:_((()=>[L(I(e.info.user.nickname),1)])),_:1}),e.info.user.id===e.authorId?(b(),y(l,{key:0},{default:_((()=>[i(r,{color:"#99CCFF"},{default:_((()=>[ve])),_:1})])),_:1})):T("v-if",!0),i(l,null,{default:_((()=>[i(m,{l:e.info.user.level},null,8,["l"])])),_:1}),i(l,{style:{"margin-left":"auto"}},{default:_((()=>[M(e.$slots,"top-right")])),_:3})])),_:1}),i(d,{class:"comment-time"},{default:_((()=>[L(I(e.$root.formatLocalTime(e.info.comment.createdAt)),1)])),_:1}),T(" 回复内容 "),i(d,{class:"comment-content"},{default:_((()=>[T(" 置顶 "),e.info.comment.top?(b(),y(r,{key:0,class:"top-tag",color:"#0099FF",plain:""},{default:_((()=>[he])),_:1})):T("v-if",!0),e.info.comment.deletedAt?(b(),y("span",ge,"该评论已删除")):(b(),y(z,{key:2},[e.info.comment.answerId?(b(),y(z,{key:0},[ke,i("span",we,"@"+I(e.info.comment.answerNickname),1),Ce],64)):T("v-if",!0),i("span",be,I(e.info.comment.content),1)],64))])),_:1}),T(" 功能 "),i(d,{class:"comment-actions",gutter:"12",align:"center"},{default:_((()=>[i(l,{class:"btn btn-like",onClick:n[1]||(n[1]=n=>e.vertifyLogin()&&e.$emit("like"))},{default:_((()=>[i(u,{class:["icon",{active:e.info.isLike}],name:e.info.isLike?"good-job":"good-job-o"},null,8,["class","name"]),i("span",ye,I(e.$root.formatBigNumber(e.info.comment.likes)),1)])),_:1}),i(l,{class:"btn btn-unlike",onClick:n[2]||(n[2]=n=>e.vertifyLogin()&&e.$emit("unlike"))},{default:_((()=>[i(u,{class:["icon",{active:e.info.isDislike}],name:e.info.isDislike?"good-job":"good-job-o"},null,8,["class","name"])])),_:1}),i(l,{class:"btn btn-reply",onClick:n[3]||(n[3]=n=>e.vertifyLogin()&&e.$emit("reply"))},{default:_((()=>[i(u,{name:"comment-o"})])),_:1}),e.info.comment.trace&&e.info.comment.answerId?(b(),y(l,{key:0,class:"btn btn-more",onClick:n[4]||(n[4]=n=>e.$emit("more"))},{default:_((()=>[_e])),_:1})):T("v-if",!0),e.isLogin?(b(),y(l,{key:1,class:"btn btn-option",onClick:e.openActionsSheet},{default:_((()=>[i(u,{name:"ellipsis"})])),_:1},8,["onClick"])):T("v-if",!0)])),_:1}),T("  "),e.info.comment.isAuthorLike?(b(),y(r,{key:0},{default:_((()=>[Le])),_:1})):T("v-if",!0),T(" 更多留言 "),e.info.children&&0!=e.info.children.length?(b(),y("div",Ie,[(b(!0),y(z,null,N(e.info.children,(e=>(b(),y("div",{class:"van-multi-ellipsis--l2",key:e.id},[i("span",xe,I(e.userNickname),1),i("span",Se,[e.answerId?(b(),y(z,{key:0},[Ae,i("span",Ue,"@"+I(e.answerNickname),1)],64)):T("v-if",!0),i("span",null,":"+I(e.content),1)])])))),128)),i("div",{class:"btn-more",onClick:n[5]||(n[5]=n=>e.$emit("more"))},"共"+I(e.info.comment.answers)+"条回复 >",1)])):T("v-if",!0)])),_:1})])),_:1})):T("v-if",!0)};const Re=n({name:"comment-conversation-pop",props:{info:{type:Object,required:!0}},components:{[pe.name]:pe,[ue.name]:ue,[r.name]:r,[ae.name]:ae},setup(e,n){const t=$(),o=h(!1),a=O((()=>t.state.userId)),i=x(A),{info:s}=g(e),{listManager:c,resetListManager:l}=j.factor().buildList();const r=h(!1),m=h(""),{authorInfo:d,resetAuthorInfo:u,buildSetCommentFn:f}=j.factor().buildCommentInfo();let p,v=0;return{listManager:c,loadComments:async function(){await j.factor().getCommentConversation(s.value.comment.contentId,s.value.comment.upstairsId,s.value.comment.trace,c)},popupOpenHandle:function(){o.value=!0},popupClosedHandle:function(){l(),o.value=!1},isRenderList:o,showComment:r,commentText:m,authorInfo:d,resetAuthorInfo:u,replyComment:function(e,n){v=n,d.avatarUrl=e.user.avatarUrl,d.nickname=e.user.nickname,r.value=!0,p=f({content_id:e.comment.contentId,upstairs_id:e.comment.upstairsId,answer_id:e.comment.id,trace:e.comment.trace,answer_user_id:e.user.id,answer_nickname:e.user.nickname})},sentHandle:async function(){const e=await p(m.value);return c.list.splice(v+1,0,{...e.data,children:[],relation:B.RELATION_UNKNOW}),v=0,!e.code},likeComment:async function(e){const n=i?.value==a.value;(await j.factor().likeComment(e.comment.id,n,e.comment.userId)).code||(e.isLike?e.comment.likes-=1:e.comment.likes+=1,e.isLike=!e.isLike,e.comment.isAuthorLike=n?e.isLike:e.comment.isAuthorLike)},dislikeComment:async function(e){(await j.factor().disLikeComment(e.comment.id)).code||(e.isDislike?e.comment.dislikes-=1:e.comment.dislikes+=1,e.isDislike=!e.isDislike)}}}}),Te=i("div",{class:"title"},"对话列表",-1),Me={class:"content"};Re.render=function(e,n,t,o,a,c){const l=C("comment-item"),r=C("van-list"),m=C("comment-edit"),d=C("van-popup");return b(),y(d,s(e.$attrs,{class:"comment-conversation-pop",position:"bottom","transition-appear":"","close-on-popstate":"","safe-area-inset-bottom":"",style:{height:"70%"},onOpen:e.popupOpenHandle,onClosed:e.popupClosedHandle}),{default:_((()=>[Te,i("div",Me,[e.isRenderList?(b(),y(r,{key:0,loading:e.listManager.loading,"onUpdate:loading":n[1]||(n[1]=n=>e.listManager.loading=n),error:e.listManager.error,"onUpdate:error":n[2]||(n[2]=n=>e.listManager.error=n),finished:e.listManager.finished,"finished-text":"没有更多了",onLoad:e.loadComments},{default:_((()=>[(b(!0),y(z,null,N(e.listManager.list,((n,t)=>(b(),y(l,{info:n,key:n.id,onLike:t=>e.likeComment(n),onUnlike:t=>e.dislikeComment(n),onReply:o=>e.replyComment(n,t)},null,8,["info","onLike","onUnlike","onReply"])))),128))])),_:1},8,["loading","error","finished","onLoad"])):T("v-if",!0)]),i(m,{show:e.showComment,"onUpdate:show":n[3]||(n[3]=n=>e.showComment=n),field:e.commentText,"onUpdate:field":n[4]||(n[4]=n=>e.commentText=n),avatar:e.authorInfo.avatarUrl,nickname:e.authorInfo.nickname,"sent-callback":e.sentHandle,onClosed:e.resetAuthorInfo},null,8,["show","field","avatar","nickname","sent-callback","onClosed"])])),_:1},16,["onOpen","onClosed"])};const ze=n({name:"comment-pop",components:{[pe.name]:pe,[ue.name]:ue,[ae.name]:ae,[Re.name]:Re},props:{comment:{type:Object,requried:!0}},setup(e,n){const t=$(),{comment:o}=g(e),a=h(B.RELATION_UNKNOW),i=h(!1),s=O((()=>t.state.userId)),c=x(A),{listManager:l,resetListManager:r}=j.factor().buildList();const m=h(null);const d=h(!1),u=h(""),{authorInfo:f,resetAuthorInfo:p,buildSetCommentFn:v}=j.factor().buildCommentInfo();let k,w=0;const C=h(!1),b=h(null);const y=h(!1);return{popupOpenHandle:function(){m.value={...H(o),children:[]},o?.value&&(i.value=!0,async function(){a.value=await F.factor().getRelationById(o?.value.user.id)}())},popupClosedHandle:function(){r(),m.value=null,i.value=!1},onLoadComments:async function(){await j.factor().getCommentDetail(o.value.comment.contentId,o.value.comment.id,l)},listManager:l,authorInfo:f,replyComment:function(e,n){w=n,f.avatarUrl=String(e.user.avatarUrl),f.nickname=String(e.user.nickname),d.value=!0,k=v({content_id:o.value.comment.contentId,upstairs_id:o.value.comment.id,answer_id:e.comment.id,answer_nickname:e.user.nickname,trace:e.comment.trace,answer_user_id:e.user.id})},resetAuthorInfo:p,sentHandle:async function(){const e=await k(u.value);return l.list.splice(w+1,0,{...e.data,children:[],relation:B.RELATION_UNKNOW}),w=0,!e.code},showComment:d,commentText:u,masterComment:m,showConverstaion:C,conversationComment:b,shoeMoreComment:function(e){if(!e.comment.trace)return console.error("trace invalid:",e.comment.trace);b.value=e,C.value=!0},GetRelationStr:F.getRelationStr,changeRelation:async function(){a.value=await F.factor().actionRelation(o.value.user.id,a.value)},changeRelationBtnLoading:y,relation:a,likeComment:async function(e){const n=c?.value==s.value;(await j.factor().likeComment(e.comment.id,n,e.comment.userId)).code||(e.isLike?e.comment.likes-=1:e.comment.likes+=1,e.isLike=!e.isLike,e.comment.isAuthorLike=n?e.isLike:e.comment.isAuthorLike)},isRenderList:i,userId:s,dislikeComment:async function(e){(await j.factor().disLikeComment(e.comment.id)).code||(e.isDislike?e.comment.dislikes-=1:e.comment.dislikes+=1,e.isDislike=!e.isDislike)}}}}),Ne=i("div",{class:"title"},"评论详情",-1),$e={class:"content"},Oe={class:"lists"},je={class:"title"};ze.render=function(e,n,t,o,a,c){const l=C("van-button"),r=C("comment-item"),m=C("van-list"),d=C("comment-edit"),u=C("comment-conversation-pop"),f=C("van-popup");return b(),y(f,s(e.$attrs,{class:"comment-pop",position:"bottom","transition-appear":"","close-on-popstate":"","safe-area-inset-bottom":"",style:{height:"70%"},onOpen:e.popupOpenHandle,onClosed:e.popupClosedHandle}),{default:_((()=>[Ne,i("div",$e,[e.isRenderList?(b(),y(m,{key:0,loading:e.listManager.loading,"onUpdate:loading":n[1]||(n[1]=n=>e.listManager.loading=n),error:e.listManager.error,"onUpdate:error":n[2]||(n[2]=n=>e.listManager.error=n),finished:e.listManager.finished,"finished-text":e.listManager.finishedText,"error-text":e.listManager.errorText,onLoad:e.onLoadComments},{default:_((()=>[e.masterComment?(b(),y(r,{key:0,class:"master-item",info:e.masterComment},D({_:2},[e.relation>0&&e.masterComment.user.id!=e.userId?{name:"top-right",fn:_((()=>[i(l,{size:"mini",color:"#0099FF",plain:"","no-border":"",onClick:e.changeRelation,loading:e.changeRelationBtnLoading},{default:_((()=>[L(I(e.GetRelationStr(e.relation)),1)])),_:1},8,["onClick","loading"])]))}:void 0]),1032,["info"])):T("v-if",!0),i("div",Oe,[i("div",je,"相关回复共"+I(e.masterComment&&e.masterComment.comment.answers)+"条",1),(b(!0),y(z,null,N(e.listManager.list,((n,t)=>(b(),y(r,{info:n,key:n.id,onReply:o=>e.replyComment(n,t),onLike:t=>e.likeComment(n),onMore:t=>e.shoeMoreComment(n),onUnlike:t=>e.dislikeComment(n)},null,8,["info","onReply","onLike","onMore","onUnlike"])))),128))])])),_:1},8,["loading","error","finished","finished-text","error-text","onLoad"])):T("v-if",!0)]),i(d,{show:e.showComment,"onUpdate:show":n[3]||(n[3]=n=>e.showComment=n),field:e.commentText,"onUpdate:field":n[4]||(n[4]=n=>e.commentText=n),avatar:e.authorInfo.avatarUrl,nickname:e.authorInfo.nickname,"sent-callback":e.sentHandle,onClosed:e.resetAuthorInfo},null,8,["show","field","avatar","nickname","sent-callback","onClosed"]),e.conversationComment?(b(),y(u,{key:0,show:e.showConverstaion,"onUpdate:show":n[5]||(n[5]=n=>e.showConverstaion=n),info:e.conversationComment},null,8,["show","info"])):T("v-if",!0)])),_:1},16,["onOpen","onClosed"])};const Be=n({name:"sponsor-pop",components:{[ie.name]:ie,[se.name]:se,[v.name]:v,[ne.name]:ne},props:{author:{type:Object,required:!0},contentId:{required:!0,type:Number}},emits:["close","successful"],setup(e,n){const t=h(1),o=E({index:1,list:[{key:1},{key:2},{key:3},{key:4}]}),{author:a,contentId:i}=g(e);return{confirmTip:async function(){if(!t.value)return w.fail("请选择选择金额!");(await P.factor().tipContent(i.value,a.value.id,t.value)).code||n.emit("successful",t.value),n.emit("close")},priceList:o,tipPrice:t,onPopClosed:function(){t.value=1,o.index=1}}}}),Fe={class:"title"},He={class:"price_num"},De={class:"footer"},Ee=L("取消"),Pe=L("确认");Be.render=function(e,n,t,o,a,c){const l=C("van-image"),r=C("van-radio"),m=C("van-radio-group"),d=C("van-button"),u=C("van-popup");return b(),y(u,s(e.$attrs,{"transition-appear":"",round:"",class:"sponsor-pop",onClosed:e.onPopClosed}),{default:_((()=>[i("div",Fe,[i(l,{class:"avatarImage",src:e.$root.getAvatar(e.author.avatarUrl),round:"",fit:"cover"},null,8,["src"]),i("div",null,[i("span",null,I(e.author.nickname),1)])]),i(m,{class:"price-btns",modelValue:e.priceList.index,"onUpdate:modelValue":n[1]||(n[1]=n=>e.priceList.index=n),onChange:n[2]||(n[2]=n=>e.tipPrice=e.priceList.index)},{default:_((()=>[(b(!0),y(z,null,N(e.priceList.list,(e=>(b(),y(r,{name:e.key,key:e.key},{default:_((()=>[i("div",He,I(e.key)+"硬币",1)])),_:2},1032,["name"])))),128))])),_:1},8,["modelValue"]),i("div",De,[i(d,{onClick:n[3]||(n[3]=n=>e.$emit("close"))},{default:_((()=>[Ee])),_:1}),i(d,{onClick:e.confirmTip},{default:_((()=>[Pe])),_:1},8,["onClick"])])])),_:1},16,["onClosed"])};const qe=n({name:"comment-action-sheet",components:{[de.name]:de},props:{actions:{type:Array,required:!0}}});qe.render=function(e,n,t,o,a,i){const c=C("van-action-sheet");return b(),y(c,s({class:"comment-action-sheet Component"},e.$attrs,{actions:e.actions,round:!1,"cancel-text":"取消","close-on-popstate":"","close-on-click-action":""}),null,16,["actions"])};const Ge=n({name:"like-item",components:{[ee.name]:ee,[Y.name]:Y,[ne.name]:ne,[te.name]:te},emits:["change-relation"],props:{item:{type:Object,required:!0}},setup(e,n){const{item:t}=g(e),o=h(!1),a=$(),i=O((()=>a.getters[q.GET_USER_ID]));return{GetRelationStr:F.getRelationStr,changeRelation:async function(){n.emit("change-relation",F.factor().actionRelation(t.value.id,t.value.relation))},changeRelationBtnLoading:o,userId:i}}});var Ve,We;Ge.render=function(e,n,t,o,a,s){const c=C("van-image"),l=C("van-col"),r=C("level"),m=C("van-button"),d=C("van-row");return e.item?(b(),y(d,{key:0,class:"like-item Component",gutter:"5",align:"center"},{default:_((()=>[i(l,{span:"2"},{default:_((()=>[i(c,{class:"avatar",round:"",fit:"cover",src:e.$root.getAvatar(e.item.avatarUrl)},null,8,["src"])])),_:1}),i(l,{span:"22",class:"van-hairline--bottom"},{default:_((()=>[i(d,{align:"center",gutter:"5"},{default:_((()=>[i(l,{class:"nickname"},{default:_((()=>[L(I(e.item.nickname),1)])),_:1}),i(l,null,{default:_((()=>[i(r,{l:e.item.level},null,8,["l"])])),_:1}),e.userId!==e.item.id&&e.item.relation>0?(b(),y(l,{key:0,"item-right":""},{default:_((()=>[i(m,{size:"mini",color:"#0099FF",plain:"","no-border":"",loading:e.changeRelationBtnLoading,onClick:e.changeRelation},{default:_((()=>[L(I(e.GetRelationStr(e.item.relation)),1)])),_:1},8,["loading","onClick"])])),_:1})):T("v-if",!0)])),_:1}),i(d,null,{default:_((()=>[i(l,{class:"describe"},{default:_((()=>[L(I(e.item.bio||"这个人很懒什么都没留下"),1)])),_:1})])),_:1})])),_:1})])),_:1})):T("v-if",!0)},(We=Ve||(Ve={}))[We.Top=0]="Top",We[We.Delete=1]="Delete",We[We.Block=2]="Block",We[We.Report=3]="Report";var Ke=n({name:"content-page",components:{[Y.name]:Y,[ee.name]:ee,[ce.name]:ce,[le.name]:le,[d.name]:d,[ae.name]:ae,[ne.name]:ne,[ue.name]:ue,[pe.name]:pe,[ze.name]:ze,[Be.name]:Be,[qe.name]:qe,[Ge.name]:Ge,[te.name]:te},setup(){const e=G(),n=V(),t=$(),o=O((()=>t.getters[q.GET_USER_ID])),a=E({content:null,author:null,tip_count:0,relation:F.factor().relation.RELATION_UNKNOW}),i=h(!1),s=h(""),c=h(0),l=x(R),r=x(U),m=new WeakMap,d=[];W(A,c),async function(e){const t=await P.factor().getContent(e);t.code||(a.content=t.data.content,a.author=t.data.author,c.value=t.data.content.userId,r?.value&&c.value!=o.value&&(a.relation=await F.factor().getRelationById(c.value)),await f((()=>{d.push(...Array.from(document.getElementsByClassName("mark-symbol"))),d.forEach((e=>{const t=function(){const t=e.getAttribute("data-mark");n.push({path:`/topic/${t}`})};m.set(e,t),e.addEventListener("click",t)}))})))}(Number(e.params.id)),K((()=>{d.forEach((e=>{const n=m.get(e);n&&e.removeEventListener("click",n)}))}));const u=E({list:new Array});!async function(){const n=await Z.factor().getContentTips(Number(e.params.id));n.code||(u.list=n.data.list,a.tip_count=n.data.count)}();const{listManager:p}=j.factor().buildList();const{authorInfo:v,resetAuthorInfo:g,buildSetCommentFn:k}=j.factor().buildCommentInfo();let C,b=!0;const y=h(null),_=h(!1);const L=h(!1);const I=h(!1),T=E({commentActions:[],comment:null});W(S,(e=>{T.comment=e,o.value===a.content?.userId?o.value==e.user.id?T.commentActions=[{name:"置顶",val:0},{name:"删除",val:1}]:T.commentActions=[{name:"置顶",val:0},{name:"删除",val:1},{name:"拉黑",val:2},{name:"举报",val:3}]:o.value==e.user.id?T.commentActions=[{name:"删除",val:1}]:T.commentActions=[{name:"拉黑",val:2},{name:"举报",val:3}],I.value=!0}));const M=h(0),{listManager:z}=P.factor().buildList();return{contentInfo:a,showComment:i,commentsL1List:p,loadComments:async function(e=!1){await j.factor().getComments(a.content.id,p,e)},authorInfo:v,replyComment:function(e){b=!1,v.avatarUrl=String(e.user.avatarUrl),v.nickname=String(e.user.nickname),i.value=!0,C=k({content_id:a.content.id,upstairs_id:e.comment.id})},likeToContent:async function(){if(!l||!l(!0))return;(await P.factor().likeContent(Number(e.params.id))).code||a.content&&(a.content.hasLike=!0)},showMoreComment:function(e){_.value=!0,y.value=e},likeComment:async function(e){const n=c.value===o.value;(await j.factor().likeComment(e.comment.id,n,e.comment.userId)).code||(e.isLike?e.comment.likes-=1:e.comment.likes+=1,e.isLike=!e.isLike,e.comment.isAuthorLike=n?e.isLike:e.comment.isAuthorLike)},follow:async function(e,n,t){const o=await F.factor().actionRelation(e,n);t.relation=o},userId:o,onCommentToContent:function(){l&&l()&&(v.avatarUrl=a.author.avatarUrl,v.nickname=a.author.nickname,i.value=!0,C=k({content_id:a.content.id}))},onCommentEditClosed:function(){b=!0,g()},sentHandle:async function(){if(!C)return;const e=await C(s.value);return b&&p.list.unshift({...e.data,children:[],relation:B.RELATION_UNKNOW}),!e.code},commentText:s,onSponsor:function(){l&&l(!0)&&(L.value=!0)},showCommentPop:_,showSponsorPop:L,currentComment:y,onSponsorSuccessful:function(e){a.content.income+=e,a.tip_count+=1},onCommentPopClosed:function(){_.value=!1,y.value=null},onSponsorPopClosed:function(){L.value=!1},sponsorInfo:u,GetRelationStr:F.getRelationStr,showCommentActionSheet:I,commentActionInfo:T,onCommentActionSelect:async function(e){switch(console.log(e),e.val){case 0:case 1:T.comment&&async function(e){}(T.comment);break;default:w({message:"功能开发中",position:"bottom"})}},activeTab:M,dislikeComment:async function(e){(await j.factor().disLikeComment(e.comment.id)).code||(e.isDislike?e.comment.dislikes-=1:e.comment.dislikes+=1,e.isDislike=!e.isDislike)},loadLikes:async function(){await P.factor().getContentLikes(a.content.id,z)},contentLikesManager:z,onChangeRelation:function(e,n){e.relation=n}}}});const Ze=X();J("data-v-6fec0d90");const Je={class:"content"},Qe={class:"title"},Xe={key:1,class:"sponsorList"},Ye=L("赞赏"),en=L("暂无打赏"),nn={key:0,class:"tips"},tn=i("div",{class:"commentsTitle van-hairline--bottom"},"热门评论",-1),on={class:"commentsList"},an=i("div",{class:"name"},"转发",-1),sn=i("div",{class:"name"},"评论",-1),cn=i("div",{class:"name"},"点赞",-1);Q();const ln=Ze(((e,n,t,o,a,s)=>{const c=C("van-image"),l=C("van-col"),r=C("van-button"),m=C("van-row"),d=C("Header"),u=C("level"),f=C("comment-item"),p=C("van-list"),v=C("van-tab"),h=C("like-item"),g=C("van-tabs"),k=C("van-icon"),w=C("comment-pop"),_=C("comment-edit"),x=C("sponsor-pop"),S=C("comment-action-sheet"),A=C("Layout");return b(),y(A,{class:"Content",header:""},D({_:2},[e.contentInfo.content?{name:"default",fn:Ze((({top:t})=>[i(d,{class:"van-hairline--bottom",fixed:"",animation:"",multiple:"",onClickLeft:n[2]||(n[2]=n=>e.$router.back())},{default:Ze((()=>[t>100?(b(),y(m,{key:0,class:"author",align:"center",gutter:"4"},{default:Ze((()=>[i(l,{class:"avatarCol"},{default:Ze((()=>[i(c,{class:"avatarImage",src:e.$root.getAvatar(e.contentInfo.author.avatarUrl),round:"",fit:"cover"},null,8,["src"])])),_:1}),i(l,{class:"authorName"},{default:Ze((()=>[L(I(e.contentInfo.author.nickname),1)])),_:1}),e.contentInfo.relation>0&&e.contentInfo.author.id!=e.userId?(b(),y(l,{key:0},{default:Ze((()=>[i(r,{class:"headerRelationBtn",size:"mini","no-border":"",onClick:n[1]||(n[1]=n=>e.follow(e.contentInfo.content.userId,e.contentInfo.relation,e.contentInfo))},{default:Ze((()=>[L(I(e.GetRelationStr(e.contentInfo.relation)),1)])),_:1})])),_:1})):T("v-if",!0)])),_:1})):T("v-if",!0)])),_:2},1024),i("div",Je,[i("div",Qe,I(e.contentInfo.content.title),1),e.contentInfo.author?(b(),y(m,{key:0,class:"author",align:"center"},{default:Ze((()=>[i(l,{class:"avatarCol",span:"2"},{default:Ze((()=>[i(c,{class:"avatarImage",src:e.$root.getAvatar(e.contentInfo.author.avatarUrl),round:"",fit:"cover"},null,8,["src"])])),_:1}),i(l,{class:"centerCol",span:"17"},{default:Ze((()=>[i(m,{gutter:"5"},{default:Ze((()=>[i(l,{class:"authorName"},{default:Ze((()=>[L(I(e.contentInfo.author.nickname),1)])),_:1}),i(l,null,{default:Ze((()=>[i(u,{l:e.contentInfo.author.level},null,8,["l"])])),_:1})])),_:1}),i(m,null,{default:Ze((()=>[i(l,{class:"publishTime"},{default:Ze((()=>[L(I(e.$root.formatLocalTime(e.contentInfo.content.createdAt)),1)])),_:1})])),_:1})])),_:1}),e.contentInfo.relation>0&&e.contentInfo.author.id!=e.userId?(b(),y(l,{key:0,style:{"margin-left":"auto"}},{default:Ze((()=>[i(r,{type:"danger",size:"mini",onClick:n[3]||(n[3]=n=>e.follow(e.contentInfo.content.userId,e.contentInfo.relation,e.contentInfo))},{default:Ze((()=>[L(I(e.GetRelationStr(e.contentInfo.relation)),1)])),_:1})])),_:1})):T("v-if",!0)])),_:1})):T("v-if",!0),i("div",{class:"contentContent",innerHTML:e.contentInfo.content.content},null,8,["innerHTML"]),e.contentInfo.content.userId!=e.userId?(b(),y("div",Xe,[i("div",null,[i(r,{size:"small",type:"danger",onClick:e.onSponsor},{default:Ze((()=>[Ye])),_:1},8,["onClick"])]),i(m,{class:"sponsorInfo",justify:"center",align:"center"},{default:Ze((()=>[e.contentInfo.tip_count?(b(),y(z,{key:0},[i(l,null,{default:Ze((()=>[L(I(e.contentInfo.tip_count)+"人赞赏了",1)])),_:1}),i(l,null,{default:Ze((()=>[L(I(e.contentInfo.content.income)+"硬币",1)])),_:1})],64)):(b(),y(l,{key:1},{default:Ze((()=>[en])),_:1}))])),_:1}),e.sponsorInfo.list.length>0?(b(),y("div",nn,[(b(!0),y(z,null,N(e.sponsorInfo.list,(n=>(b(),y("div",{class:"tipItem",key:n.id},[i(c,{class:"avatarImage",fit:"contain",src:e.$root.getAvatar(n.user.avatarUrl)},null,8,["src"])])))),128))])):T("v-if",!0)])):T("v-if",!0),i(g,{class:"contentSubTabs",active:e.activeTab,"onUpdate:active":n[8]||(n[8]=n=>e.activeTab=n),"offset-top":"10.6667vw","line-width":"0px",sticky:""},{default:Ze((()=>[i(v,{title:`评论 ${e.$root.formatBigNumber(e.contentInfo.content.comments)}`},{default:Ze((()=>[tn,i("div",on,[i(p,{loading:e.commentsL1List.loading,"onUpdate:loading":n[4]||(n[4]=n=>e.commentsL1List.loading=n),error:e.commentsL1List.error,"onUpdate:error":n[5]||(n[5]=n=>e.commentsL1List.error=n),finished:e.commentsL1List.finished,"finished-text":"没有更多留言！",onLoad:e.loadComments},{default:Ze((()=>[(b(!0),y(z,null,N(e.commentsL1List.list,(n=>(b(),y(f,{info:n,key:n.id,onLike:t=>e.likeComment(n),onUnlike:t=>e.dislikeComment(n),onReply:t=>e.replyComment(n),onMore:t=>e.showMoreComment(n)},D({_:2},[e.userId!==n.comment.userId&&n.relation>0?{name:"top-right",fn:Ze((()=>[i(r,{size:"mini",color:"#0099FF",plain:"","no-border":"",onClick:t=>e.follow(n.comment.userId,n.relation,n)},{default:Ze((()=>[L(I(e.GetRelationStr(n.relation)),1)])),_:2},1032,["onClick"])]))}:void 0]),1032,["info","onLike","onUnlike","onReply","onMore"])))),128))])),_:1},8,["loading","error","finished","onLoad"])])])),_:1},8,["title"]),i(v,{title:`点赞 ${e.$root.formatBigNumber(e.contentInfo.content.likes)}`},{default:Ze((()=>[i(p,{loading:e.contentLikesManager.loading,"onUpdate:loading":n[6]||(n[6]=n=>e.contentLikesManager.loading=n),error:e.contentLikesManager.error,"onUpdate:error":n[7]||(n[7]=n=>e.contentLikesManager.error=n),finished:e.contentLikesManager.finished,"finished-text":"没有更多点赞！",onLoad:e.loadLikes},{default:Ze((()=>[(b(!0),y(z,null,N(e.contentLikesManager.list,(n=>(b(),y(h,{item:n,key:n.id,onChangeRelation:t=>e.onChangeRelation(n,t)},null,8,["item","onChangeRelation"])))),128))])),_:1},8,["loading","error","finished","onLoad"])])),_:1},8,["title"])])),_:1},8,["active"]),i(m,{class:"contentFooter van-hairline--top",gutter:"5",align:"center"},{default:Ze((()=>[i(l,{class:"action","icon-wrap":"",span:"8"},{default:Ze((()=>[i(k,{"class-prefix":"lc-ali",name:"resonserate"}),an])),_:1}),i(l,{class:"action","icon-wrap":"",span:"8",onClick:e.onCommentToContent},{default:Ze((()=>[i(k,{"class-prefix":"lc-ali",name:"comments"}),sn])),_:1},8,["onClick"]),i(l,{class:"action","icon-wrap":"",span:"8",onClick:e.likeToContent},{default:Ze((()=>[i(k,{"class-prefix":"lc-ali",name:e.contentInfo.content.hasLike?"good-fill":"good"},null,8,["name"]),cn])),_:1},8,["onClick"])])),_:1}),i(w,{show:e.showCommentPop,"onUpdate:show":n[9]||(n[9]=n=>e.showCommentPop=n),comment:e.currentComment,onClosed:e.onCommentPopClosed},null,8,["show","comment","onClosed"]),i(_,{show:e.showComment,"onUpdate:show":n[10]||(n[10]=n=>e.showComment=n),field:e.commentText,"onUpdate:field":n[11]||(n[11]=n=>e.commentText=n),avatar:e.authorInfo.avatarUrl,nickname:e.authorInfo.nickname,"sent-callback":e.sentHandle,onClosed:e.onCommentEditClosed},null,8,["show","field","avatar","nickname","sent-callback","onClosed"]),i(x,{show:e.showSponsorPop,"onUpdate:show":n[12]||(n[12]=n=>e.showSponsorPop=n),onClose:e.onSponsorPopClosed,onSuccessful:e.onSponsorSuccessful,"content-id":e.contentInfo.content.id,author:e.contentInfo.author},null,8,["show","onClose","onSuccessful","content-id","author"]),i(S,{show:e.showCommentActionSheet,"onUpdate:show":n[13]||(n[13]=n=>e.showCommentActionSheet=n),actions:e.commentActionInfo.commentActions,onSelect:e.onCommentActionSelect},null,8,["show","actions","onSelect"])])]))}:void 0]),1024)}));Ke.render=ln,Ke.__scopeId="data-v-6fec0d90";export default Ke;
